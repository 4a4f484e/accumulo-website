<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/bootstrap-theme.min.css" rel="stylesheet">
<link href="/css/dataTables.bootstrap.css" rel="stylesheet">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<title>Apache Accumulo Visibility, Authorizations, and Permissions Example</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.dataTables.min.js"></script>
<script src="/js/dataTables.bootstrap.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // configure Google Analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  if (ga.hasOwnProperty('loaded') && ga.loaded === true) {
    ga('create', 'UA-50934829-1', 'apache.org');
    ga('send', 'pageview');
  }
</script>
</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/"><img id="nav-logo" alt="Apache Accumulo" class="img-responsive" src="/images/accumulo-logo.png" width="200"/></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="nav navbar-nav">
        <li class="nav-link"><a href="/downloads">Download</a></li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">1.8.0 Release (Latest)</li>
          <li id="nav_rn_180"><a href="/release_notes/1.8.0">Release Notes</a></li>
          <li><a href="/1.8/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.8/apidocs">Javadoc</a></li>
          <li id="nav_examples_18"><a href="/1.8/examples">Examples</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">1.7.2 Release</li>
          <li id="nav_rn_172"><a href="/release_notes/1.7.2">Release Notes</a></li>
          <li><a href="/1.7/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.7/apidocs">Javadoc</a></li>
          <li id="nav_examples_17"><a href="/1.7/examples">Examples</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">1.6.6 Release</li>
          <li id="nav_rn_166"><a href="/release_notes/1.6.6">Release Notes</a></li>
          <li><a href="/1.6/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.6/apidocs">Javadoc</a></li>
          <li id="nav_examples_16"><a href="/1.6/examples">Examples</a></li>
          <li class="divider"></li>
          <li id="nav_features"><a href="/notable_features">Features</a></li>
          <li id="nav_rn"><a href="/release_notes">Release Notes Archive</a></li>
          <li id="old_documentation"><a href="/old_documentation">Documentation Archive</a></li>
          <li id="nav_screenshots"><a href="/screenshots">Screenshots</a></li>
          <li id="nav_papers"><a href="/papers">Papers &amp; Presentations</a></li>
          <li id="nav_glossary"><a href="/glossary">Glossary</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li id="nav_getinvolved"><a href="/get_involved">Get Involved</a></li>
          <li id="nav_mailinglists"><a href="/mailing_list">Mailing Lists</a></li>
          <li id="nav_people"><a href="/people">People</a></li>
          <li id="nav_blog"><a href="https://blogs.apache.org/accumulo">Blog <i class="fa fa-external-link"></i></a></li>
          <li id="nav_projects"><a href="/projects">Community Projects</a></li>
          <li id="nav_thanks"><a href="/thanks">Thanks</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Governance</li>
          <li id="nav_bylaws"><a href="/bylaws">Bylaws</a></li>
          <li id="nav_consensusbuilding"><a href="/governance/consensusBuilding">Consensus Building</a></li>
          <li id="nav_lazyconsensus"><a href="/governance/lazyConsensus">Lazy Consensus</a></li>
          <li id="nav_govreleasing"><a href="/governance/releasing">Releasing</a></li>
          <li id="nav_voting"><a href="/governance/voting">Voting</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Development<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://issues.apache.org/jira/browse/ACCUMULO">Issue Tracker <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://github.com/apache/accumulo/pulls">Pull Requests <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://builds.apache.org/view/A/view/Accumulo">Jenkins Builds <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://travis-ci.org/apache/accumulo">TravisCI Builds <i class="fa fa-external-link"></i></a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Guides</li>
          <li id="nav_source"><a href="/source">Source &amp; Guide</a></li>
          <li id="nav_git"><a href="/git">Git Workflow</a></li>
          <li id="nav_versioning"><a href="/versioning">Versioning</a></li>
          <li id="nav_contrib"><a href="/contrib">Contrib Projects</a></li>
          <li id="nav_rb"><a href="/rb">Review Board</a></li>
          <li id="nav_releasing"><a href="/releasing">Making Releases</a></li>
          <li id="nav_verify_release"><a href="/verifying_releases">Verifying Releases</a></li>
        </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apache Software Foundation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://www.apache.org">Apache Homepage <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/licenses/LICENSE-2.0">License <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/security">Security <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/thanks">Thanks <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <i class="fa fa-external-link"></i></a></li>
        </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <h1 class="title">Apache Accumulo Visibility, Authorizations, and Permissions Example</h1>
          
          <h2 id="creating-a-new-user">Creating a new user</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>root@instance&gt; createuser username
Enter new password for 'username': ********
Please confirm new password for 'username': ********
root@instance&gt; user username
Enter password for user username: ********
username@instance&gt; createtable vistest
06 10:48:47,931 [shell.Shell] ERROR: org.apache.accumulo.core.client.AccumuloSecurityException: Error PERMISSION_DENIED - User does not have permission to perform this action
username@instance&gt; userpermissions
System permissions:

Table permissions (accumulo.metadata): Table.READ
username@instance&gt;
</code></pre>
</div>

<p>A user does not by default have permission to create a table.</p>

<h2 id="granting-permissions-to-a-user">Granting permissions to a user</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance&gt; user root
Enter password for user root: ********
root@instance&gt; grant -s System.CREATE_TABLE -u username
root@instance&gt; user username
Enter password for user username: ********
username@instance&gt; createtable vistest
username@instance&gt; userpermissions
System permissions: System.CREATE_TABLE

Table permissions (accumulo.metadata): Table.READ
Table permissions (vistest): Table.READ, Table.WRITE, Table.BULK_IMPORT, Table.ALTER_TABLE, Table.GRANT, Table.DROP_TABLE
username@instance vistest&gt;
</code></pre>
</div>

<h2 id="inserting-data-with-visibilities">Inserting data with visibilities</h2>

<p>Visibilities are boolean AND (&amp;) and OR (|) combinations of authorization
tokens. Authorization tokens are arbitrary strings taken from a restricted
ASCII character set. Parentheses are required to specify order of operations
in visibilities.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; insert row f1 q1 v1 -l A
username@instance vistest&gt; insert row f2 q2 v2 -l A&amp;B
username@instance vistest&gt; insert row f3 q3 v3 -l apple&amp;carrot|broccoli|spinach
06 11:19:01,432 [shell.Shell] ERROR: org.apache.accumulo.core.util.BadArgumentException: cannot mix | and &amp; near index 12
apple&amp;carrot|broccoli|spinach
            ^
username@instance vistest&gt; insert row f3 q3 v3 -l (apple&amp;carrot)|broccoli|spinach
username@instance vistest&gt;
</code></pre>
</div>

<h2 id="scanning-with-authorizations">Scanning with authorizations</h2>

<p>Authorizations are sets of authorization tokens. Each Accumulo user has
authorizations and each Accumulo scan has authorizations. Scan authorizations
are only allowed to be a subset of the user’s authorizations. By default, a
user’s authorizations set is empty.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; scan
username@instance vistest&gt; scan -s A
06 11:43:14,951 [shell.Shell] ERROR: java.lang.RuntimeException: org.apache.accumulo.core.client.AccumuloSecurityException: Error BAD_AUTHORIZATIONS - The user does not have the specified authorizations assigned
username@instance vistest&gt;
</code></pre>
</div>

<h2 id="setting-authorizations-for-a-user">Setting authorizations for a user</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; setauths -s A
06 11:53:42,056 [shell.Shell] ERROR: org.apache.accumulo.core.client.AccumuloSecurityException: Error PERMISSION_DENIED - User does not have permission to perform this action
username@instance vistest&gt;
</code></pre>
</div>

<p>A user cannot set authorizations unless the user has the System.ALTER_USER permission.
The root user has this permission.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; user root
Enter password for user root: ********
root@instance vistest&gt; setauths -s A -u username
root@instance vistest&gt; user username
Enter password for user username: ********
username@instance vistest&gt; scan -s A
row f1:q1 [A]    v1
username@instance vistest&gt; scan
row f1:q1 [A]    v1
username@instance vistest&gt;
</code></pre>
</div>

<p>The default authorizations for a scan are the user’s entire set of authorizations.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; user root
Enter password for user root: ********
root@instance vistest&gt; setauths -s A,B,broccoli -u username
root@instance vistest&gt; user username
Enter password for user username: ********
username@instance vistest&gt; scan
row f1:q1 [A]    v1
row f2:q2 [A&amp;B]    v2
row f3:q3 [(apple&amp;carrot)|broccoli|spinach]    v3
username@instance vistest&gt; scan -s B
username@instance vistest&gt;
</code></pre>
</div>

<p>If you want, you can limit a user to only be able to insert data which they can read themselves.
It can be set with the following constraint.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; user root
Enter password for user root: ******
root@instance vistest&gt; config -t vistest -s table.constraint.1=org.apache.accumulo.core.security.VisibilityConstraint
root@instance vistest&gt; user username
Enter password for user username: ********
username@instance vistest&gt; insert row f4 q4 v4 -l spinach
    Constraint Failures:
        ConstraintViolationSummary(constrainClass:org.apache.accumulo.core.security.VisibilityConstraint, violationCode:2, violationDescription:User does not have authorization on column visibility, numberOfViolatingMutations:1)
username@instance vistest&gt; insert row f4 q4 v4 -l spinach|broccoli
username@instance vistest&gt; scan
row f1:q1 [A]    v1
row f2:q2 [A&amp;B]    v2
row f3:q3 [(apple&amp;carrot)|broccoli|spinach]    v3
row f4:q4 [spinach|broccoli]    v4
username@instance vistest&gt;
</code></pre>
</div>


        </div>

        
<footer>

  <p><a href="https://www.apache.org"><img src="/images/feather-small.gif" alt="Apache Software Foundation" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2016 The Apache Software Foundation. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>

  <p>Site created with <a href="https://getbootstrap.com">Bootstrap</a> including icons from
<a href="https://glyphicons.com">GLYPHICONS</a> and <a href="http://fontawesome.io">Font Awesome</a>.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
