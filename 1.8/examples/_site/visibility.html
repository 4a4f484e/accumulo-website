<h2 id="creating-a-new-user">Creating a new user</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>root@instance&gt; createuser username
Enter new password for 'username': ********
Please confirm new password for 'username': ********
root@instance&gt; user username
Enter password for user username: ********
username@instance&gt; createtable vistest
06 10:48:47,931 [shell.Shell] ERROR: org.apache.accumulo.core.client.AccumuloSecurityException: Error PERMISSION_DENIED - User does not have permission to perform this action
username@instance&gt; userpermissions
System permissions:

Table permissions (accumulo.metadata): Table.READ
username@instance&gt;
</code></pre>
</div>

<p>A user does not by default have permission to create a table.</p>

<h2 id="granting-permissions-to-a-user">Granting permissions to a user</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance&gt; user root
Enter password for user root: ********
root@instance&gt; grant -s System.CREATE_TABLE -u username
root@instance&gt; user username
Enter password for user username: ********
username@instance&gt; createtable vistest
username@instance&gt; userpermissions
System permissions: System.CREATE_TABLE

Table permissions (accumulo.metadata): Table.READ
Table permissions (vistest): Table.READ, Table.WRITE, Table.BULK_IMPORT, Table.ALTER_TABLE, Table.GRANT, Table.DROP_TABLE
username@instance vistest&gt;
</code></pre>
</div>

<h2 id="inserting-data-with-visibilities">Inserting data with visibilities</h2>

<p>Visibilities are boolean AND (&amp;) and OR (|) combinations of authorization
tokens. Authorization tokens are arbitrary strings taken from a restricted
ASCII character set. Parentheses are required to specify order of operations
in visibilities.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; insert row f1 q1 v1 -l A
username@instance vistest&gt; insert row f2 q2 v2 -l A&amp;B
username@instance vistest&gt; insert row f3 q3 v3 -l apple&amp;carrot|broccoli|spinach
06 11:19:01,432 [shell.Shell] ERROR: org.apache.accumulo.core.util.BadArgumentException: cannot mix | and &amp; near index 12
apple&amp;carrot|broccoli|spinach
            ^
username@instance vistest&gt; insert row f3 q3 v3 -l (apple&amp;carrot)|broccoli|spinach
username@instance vistest&gt;
</code></pre>
</div>

<h2 id="scanning-with-authorizations">Scanning with authorizations</h2>

<p>Authorizations are sets of authorization tokens. Each Accumulo user has
authorizations and each Accumulo scan has authorizations. Scan authorizations
are only allowed to be a subset of the user’s authorizations. By default, a
user’s authorizations set is empty.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; scan
username@instance vistest&gt; scan -s A
06 11:43:14,951 [shell.Shell] ERROR: java.lang.RuntimeException: org.apache.accumulo.core.client.AccumuloSecurityException: Error BAD_AUTHORIZATIONS - The user does not have the specified authorizations assigned
username@instance vistest&gt;
</code></pre>
</div>

<h2 id="setting-authorizations-for-a-user">Setting authorizations for a user</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; setauths -s A
06 11:53:42,056 [shell.Shell] ERROR: org.apache.accumulo.core.client.AccumuloSecurityException: Error PERMISSION_DENIED - User does not have permission to perform this action
username@instance vistest&gt;
</code></pre>
</div>

<p>A user cannot set authorizations unless the user has the System.ALTER_USER permission.
The root user has this permission.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; user root
Enter password for user root: ********
root@instance vistest&gt; setauths -s A -u username
root@instance vistest&gt; user username
Enter password for user username: ********
username@instance vistest&gt; scan -s A
row f1:q1 [A]    v1
username@instance vistest&gt; scan
row f1:q1 [A]    v1
username@instance vistest&gt;
</code></pre>
</div>

<p>The default authorizations for a scan are the user’s entire set of authorizations.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; user root
Enter password for user root: ********
root@instance vistest&gt; setauths -s A,B,broccoli -u username
root@instance vistest&gt; user username
Enter password for user username: ********
username@instance vistest&gt; scan
row f1:q1 [A]    v1
row f2:q2 [A&amp;B]    v2
row f3:q3 [(apple&amp;carrot)|broccoli|spinach]    v3
username@instance vistest&gt; scan -s B
username@instance vistest&gt;
</code></pre>
</div>

<p>If you want, you can limit a user to only be able to insert data which they can read themselves.
It can be set with the following constraint.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance vistest&gt; user root
Enter password for user root: ******
root@instance vistest&gt; config -t vistest -s table.constraint.1=org.apache.accumulo.core.security.VisibilityConstraint
root@instance vistest&gt; user username
Enter password for user username: ********
username@instance vistest&gt; insert row f4 q4 v4 -l spinach
    Constraint Failures:
        ConstraintViolationSummary(constrainClass:org.apache.accumulo.core.security.VisibilityConstraint, violationCode:2, violationDescription:User does not have authorization on column visibility, numberOfViolatingMutations:1)
username@instance vistest&gt; insert row f4 q4 v4 -l spinach|broccoli
username@instance vistest&gt; scan
row f1:q1 [A]    v1
row f2:q2 [A&amp;B]    v2
row f3:q3 [(apple&amp;carrot)|broccoli|spinach]    v3
row f4:q4 [spinach|broccoli]    v4
username@instance vistest&gt;
</code></pre>
</div>

