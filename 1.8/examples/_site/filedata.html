<p>This example archives file data into an Accumulo table. Files with duplicate data are only stored once.
The example has the following classes:</p>

<ul>
  <li>CharacterHistogram - A MapReduce that computes a histogram of byte frequency for each file and stores the histogram alongside the file data. An example use of the ChunkInputFormat.</li>
  <li>ChunkCombiner - An Iterator that dedupes file data and sets their visibilities to a combined visibility based on current references to the file data.</li>
  <li>ChunkInputFormat - An Accumulo InputFormat that provides keys containing file info (List&lt;Entry&lt;Key,Value») and values with an InputStream over the file (ChunkInputStream).</li>
  <li>ChunkInputStream - An input stream over file data stored in Accumulo.</li>
  <li>FileDataIngest - Takes a list of files and archives them into Accumulo keyed on hashes of the files.</li>
  <li>FileDataQuery - Retrieves file data based on the hash of the file. (Used by the dirlist.Viewer.)</li>
  <li>KeyUtil - A utility for creating and parsing null-byte separated strings into/from Text objects.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>VisibilityCombiner - A utility for merging visibilities into the form (VIS1)</td>
          <td>(VIS2)</td>
          <td>…</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<p>This example is coupled with the dirlist example. See README.dirlist for instructions.</p>

<p>If you haven’t already run the README.dirlist example, ingest a file with FileDataIngest.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ./bin/accumulo org.apache.accumulo.examples.simple.filedata.FileDataIngest -i instance -z zookeepers -u username -p password -t dataTable --auths exampleVis --chunk 1000 $ACCUMULO_HOME/README
</code></pre>
</div>

<p>Open the accumulo shell and look at the data. The row is the MD5 hash of the file, which you can verify by running a command such as ‘md5sum’ on the file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; scan -t dataTable
</code></pre>
</div>

<p>Run the CharacterHistogram MapReduce to add some information about the file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ bin/tool.sh lib/accumulo-examples-simple.jar org.apache.accumulo.examples.simple.filedata.CharacterHistogram -i instance -z zookeepers -u username -p password -t dataTable --auths exampleVis --vis exampleVis
</code></pre>
</div>

<p>Scan again to see the histogram stored in the ‘info’ column family.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; scan -t dataTable
</code></pre>
</div>
