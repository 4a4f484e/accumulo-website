<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/bootstrap-theme.min.css" rel="stylesheet">
<link href="/css/dataTables.bootstrap.css" rel="stylesheet">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<title>User Manual: Accumulo Design</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.dataTables.min.js"></script>
<script src="/js/dataTables.bootstrap.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // configure Google Analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  if (ga.hasOwnProperty('loaded') && ga.loaded === true) {
    ga('create', 'UA-50934829-1', 'apache.org');
    ga('send', 'pageview');
  }
</script>
</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/"><img id="nav-logo" alt="Apache Accumulo" class="img-responsive" src="/images/accumulo-logo.png" width="200"/></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="nav navbar-nav">
        <li class="nav-link"><a href="/downloads">Download</a></li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">1.8.0 Release (Latest)</li>
          <li id="nav_rn_180"><a href="/release_notes/1.8.0">Release Notes</a></li>
          <li><a href="/1.8/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.8/apidocs">Javadoc</a></li>
          <li id="nav_examples_18"><a href="/1.8/examples">Examples</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">1.7.2 Release</li>
          <li id="nav_rn_172"><a href="/release_notes/1.7.2">Release Notes</a></li>
          <li><a href="/1.7/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.7/apidocs">Javadoc</a></li>
          <li id="nav_examples_17"><a href="/1.7/examples">Examples</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">1.6.6 Release</li>
          <li id="nav_rn_166"><a href="/release_notes/1.6.6">Release Notes</a></li>
          <li><a href="/1.6/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.6/apidocs">Javadoc</a></li>
          <li id="nav_examples_16"><a href="/1.6/examples">Examples</a></li>
          <li class="divider"></li>
          <li id="nav_features"><a href="/notable_features">Features</a></li>
          <li id="nav_rn"><a href="/release_notes">Release Notes Archive</a></li>
          <li id="old_documentation"><a href="/old_documentation">Documentation Archive</a></li>
          <li id="nav_screenshots"><a href="/screenshots">Screenshots</a></li>
          <li id="nav_papers"><a href="/papers">Papers &amp; Presentations</a></li>
          <li id="nav_glossary"><a href="/glossary">Glossary</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li id="nav_getinvolved"><a href="/get_involved">Get Involved</a></li>
          <li id="nav_mailinglists"><a href="/mailing_list">Mailing Lists</a></li>
          <li id="nav_people"><a href="/people">People</a></li>
          <li id="nav_blog"><a href="https://blogs.apache.org/accumulo">Blog <i class="fa fa-external-link"></i></a></li>
          <li id="nav_projects"><a href="/projects">Community Projects</a></li>
          <li id="nav_thanks"><a href="/thanks">Thanks</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Governance</li>
          <li id="nav_bylaws"><a href="/bylaws">Bylaws</a></li>
          <li id="nav_consensusbuilding"><a href="/governance/consensusBuilding">Consensus Building</a></li>
          <li id="nav_lazyconsensus"><a href="/governance/lazyConsensus">Lazy Consensus</a></li>
          <li id="nav_govreleasing"><a href="/governance/releasing">Releasing</a></li>
          <li id="nav_voting"><a href="/governance/voting">Voting</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Development<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://issues.apache.org/jira/browse/ACCUMULO">Issue Tracker <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://github.com/apache/accumulo/pulls">Pull Requests <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://builds.apache.org/view/A/view/Accumulo">Jenkins Builds <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://travis-ci.org/apache/accumulo">TravisCI Builds <i class="fa fa-external-link"></i></a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Guides</li>
          <li id="nav_source"><a href="/source">Source &amp; Guide</a></li>
          <li id="nav_git"><a href="/git">Git Workflow</a></li>
          <li id="nav_versioning"><a href="/versioning">Versioning</a></li>
          <li id="nav_contrib"><a href="/contrib">Contrib Projects</a></li>
          <li id="nav_rb"><a href="/rb">Review Board</a></li>
          <li id="nav_releasing"><a href="/releasing">Making Releases</a></li>
          <li id="nav_verify_release"><a href="/verifying_releases">Verifying Releases</a></li>
        </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apache Software Foundation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://www.apache.org">Apache Homepage <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/licenses/LICENSE-2.0">License <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/security">Security <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/thanks">Thanks <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <i class="fa fa-external-link"></i></a></li>
        </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <h1 class="title">User Manual: Accumulo Design</h1>
          
          <p>** Next:** <a href="Accumulo_Shell.html">Accumulo Shell</a> ** Up:** <a href="accumulo_user_manual.html">Apache Accumulo User Manual Version 1.4</a> ** Previous:** <a href="Introduction.html">Introduction</a>   ** <a href="Contents.html">Contents</a>**</p>

<p><a id="CHILD_LINKS"></a><strong>Subsections</strong></p>

<ul>
  <li><a href="Accumulo_Design.html#Data_Model">Data Model</a></li>
  <li><a href="Accumulo_Design.html#Architecture">Architecture</a></li>
  <li><a href="Accumulo_Design.html#Components">Components</a></li>
  <li><a href="Accumulo_Design.html#Data_Management">Data Management</a></li>
  <li><a href="Accumulo_Design.html#Tablet_Service">Tablet Service</a></li>
  <li><a href="Accumulo_Design.html#Compactions">Compactions</a></li>
  <li><a href="Accumulo_Design.html#Fault-Tolerance">Fault-Tolerance</a></li>
</ul>

<hr />

<h2 id="a-idaccumulodesigna-accumulo-design"><a id="Accumulo_Design"></a> Accumulo Design</h2>

<h2 id="a-iddatamodela-data-model"><a id="Data_Model"></a> Data Model</h2>

<p>Accumulo provides a richer data model than simple key-value stores, but is not a fully relational database. Data is represented as key-value pairs, where the key and value are comprised of the following elements:</p>

<p><img src="img1.png" alt="converted table" /></p>

<p>All elements of the Key and the Value are represented as byte arrays except for Timestamp, which is a Long. Accumulo sorts keys by element and lexicographically in ascending order. Timestamps are sorted in descending order so that later versions of the same Key appear first in a sequential scan. Tables consist of a set of sorted key-value pairs.</p>

<h2 id="a-idarchitecturea-architecture"><a id="Architecture"></a> Architecture</h2>

<p>Accumulo is a distributed data storage and retrieval system and as such consists of several architectural components, some of which run on many individual servers. Much of the work Accumulo does involves maintaining certain properties of the data, such as organization, availability, and integrity, across many commodity-class machines.</p>

<h2 id="a-idcomponentsa-components"><a id="Components"></a> Components</h2>

<p>An instance of Accumulo includes many TabletServers, write-ahead Logger servers, one Garbage Collector process, one Master server and many Clients.</p>

<h3 id="a-idtabletservera-tablet-server"><a id="Tablet_Server"></a> Tablet Server</h3>

<p>The TabletServer manages some subset of all the tablets (partitions of tables). This includes receiving writes from clients, persisting writes to a write-ahead log, sorting new key-value pairs in memory, periodically flushing sorted key-value pairs to new files in HDFS, and responding to reads from clients, forming a merge-sorted view of all keys and values from all the files it has created and the sorted in-memory store.</p>

<p>TabletServers also perform recovery of a tablet that was previously on a server that failed, reapplying any writes found in the write-ahead log to the tablet.</p>

<h3 id="a-idloggersa-loggers"><a id="Loggers"></a> Loggers</h3>

<p>The Loggers accept updates to Tablet servers and write them to local on-disk storage. Each tablet server will write their updates to multiple loggers to preserve data in case of hardware failure.</p>

<h3 id="a-idgarbagecollectora-garbage-collector"><a id="Garbage_Collector"></a> Garbage Collector</h3>

<p>Accumulo processes will share files stored in HDFS. Periodically, the Garbage Collector will identify files that are no longer needed by any process, and delete them.</p>

<h3 id="a-idmastera-master"><a id="Master"></a> Master</h3>

<p>The Accumulo Master is responsible for detecting and responding to TabletServer failure. It tries to balance the load across TabletServer by assigning tablets carefully and instructing TabletServers to migrate tablets when necessary. The Master ensures all tablets are assigned to one TabletServer each, and handles table creation, alteration, and deletion requests from clients. The Master also coordinates startup, graceful shutdown and recovery of changes in write-ahead logs when Tablet servers fail.</p>

<h3 id="a-idclienta-client"><a id="Client"></a> Client</h3>

<p>Accumulo includes a client library that is linked to every application. The client library contains logic for finding servers managing a particular tablet, and communicating with TabletServers to write and retrieve key-value pairs.</p>

<h2 id="a-iddatamanagementa-data-management"><a id="Data_Management"></a> Data Management</h2>

<p>Accumulo stores data in tables, which are partitioned into tablets. Tablets are partitioned on row boundaries so that all of the columns and values for a particular row are found together within the same tablet. The Master assigns Tablets to one TabletServer at a time. This enables row-level transactions to take place without using distributed locking or some other complicated synchronization mechanism. As clients insert and query data, and as machines are added and removed from the cluster, the Master migrates tablets to ensure they remain available and that the ingest and query load is balanced across the cluster.</p>

<p><img src="./data_distribution.png" alt="Image data_distribution" /></p>

<h2 id="a-idtabletservicea-tablet-service"><a id="Tablet_Service"></a> Tablet Service</h2>

<p>When a write arrives at a TabletServer it is written to a Write-Ahead Log and then inserted into a sorted data structure in memory called a MemTable. When the MemTable reaches a certain size the TabletServer writes out the sorted key-value pairs to a file in HDFS called Indexed Sequential Access Method (ISAM) file. This process is called a minor compaction. A new MemTable is then created and the fact of the compaction is recorded in the Write-Ahead Log.</p>

<p>When a request to read data arrives at a TabletServer, the TabletServer does a binary search across the MemTable as well as the in-memory indexes associated with each ISAM file to find the relevant values. If clients are performing a scan, several key-value pairs are returned to the client in order from the MemTable and the set of ISAM files by performing a merge-sort as they are read.</p>

<h2 id="a-idcompactionsa-compactions"><a id="Compactions"></a> Compactions</h2>

<p>In order to manage the number of files per tablet, periodically the TabletServer performs Major Compactions of files within a tablet, in which some set of ISAM files are combined into one file. The previous files will eventually be removed by the Garbage Collector. This also provides an opportunity to permanently remove deleted key-value pairs by omitting key-value pairs suppressed by a delete entry when the new file is created.</p>

<h2 id="a-idfault-tolerancea-fault-tolerance"><a id="Fault-Tolerance"></a> Fault-Tolerance</h2>

<p>If a TabletServer fails, the Master detects it and automatically reassigns the tablets assigned from the failed server to other servers. Any key-value pairs that were in memory at the time the TabletServer are automatically reapplied from the Write-Ahead Log to prevent any loss of data.</p>

<p>The Master will coordinate the copying of write-ahead logs to HDFS so the logs are available to all tablet servers. To make recovery efficient, the updates within a log are grouped by tablet. The sorting process can be performed by Hadoops MapReduce or the Logger server. TabletServers can quickly apply the mutations from the sorted logs that are destined for the tablets they have now been assigned.</p>

<p>TabletServer failures are noted on the Master’s monitor page, accessible via <br />
http://master-address:50095/monitor.</p>

<p><img src="./failure_handling.png" alt="Image failure_handling" /></p>

<hr />

<p>** Next:** <a href="Accumulo_Shell.html">Accumulo Shell</a> ** Up:** <a href="accumulo_user_manual.html">Apache Accumulo User Manual Version 1.4</a> ** Previous:** <a href="Introduction.html">Introduction</a>   ** <a href="Contents.html">Contents</a>**</p>


        </div>

        
<footer>

  <p><a href="https://www.apache.org"><img src="/images/feather-small.gif" alt="Apache Software Foundation" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2016 The Apache Software Foundation. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>

  <p>Site created with <a href="https://getbootstrap.com">Bootstrap</a> including icons from
<a href="https://glyphicons.com">GLYPHICONS</a> and <a href="http://fontawesome.io">Font Awesome</a>.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
