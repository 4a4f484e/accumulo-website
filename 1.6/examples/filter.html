<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/bootstrap-theme.min.css" rel="stylesheet">
<link href="/css/dataTables.bootstrap.css" rel="stylesheet">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<title>Filter Example</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.dataTables.min.js"></script>
<script src="/js/dataTables.bootstrap.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // configure Google Analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  if (ga.hasOwnProperty('loaded') && ga.loaded === true) {
    ga('create', 'UA-50934829-1', 'apache.org');
    ga('send', 'pageview');
  }
</script>
</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/"><img id="nav-logo" alt="Apache Accumulo" class="img-responsive" src="/images/accumulo-logo.png" width="200"/></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="nav navbar-nav">
        <li class="nav-link"><a href="/downloads">Download</a></li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">1.8.0 Release (Latest)</li>
          <li id="nav_rn_180"><a href="/release_notes/1.8.0">Release Notes</a></li>
          <li><a href="/1.8/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.8/apidocs">Javadoc</a></li>
          <li id="nav_examples_18"><a href="/1.8/examples">Examples</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">1.7.2 Release</li>
          <li id="nav_rn_172"><a href="/release_notes/1.7.2">Release Notes</a></li>
          <li><a href="/1.7/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.7/apidocs">Javadoc</a></li>
          <li id="nav_examples_17"><a href="/1.7/examples">Examples</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">1.6.6 Release</li>
          <li id="nav_rn_166"><a href="/release_notes/1.6.6">Release Notes</a></li>
          <li><a href="/1.6/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.6/apidocs">Javadoc</a></li>
          <li id="nav_examples_16"><a href="/1.6/examples">Examples</a></li>
          <li class="divider"></li>
          <li id="nav_features"><a href="/notable_features">Features</a></li>
          <li id="nav_rn"><a href="/release_notes">Release Notes Archive</a></li>
          <li id="old_documentation"><a href="/old_documentation">Documentation Archive</a></li>
          <li id="nav_screenshots"><a href="/screenshots">Screenshots</a></li>
          <li id="nav_papers"><a href="/papers">Papers &amp; Presentations</a></li>
          <li id="nav_glossary"><a href="/glossary">Glossary</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li id="nav_getinvolved"><a href="/get_involved">Get Involved</a></li>
          <li id="nav_mailinglists"><a href="/mailing_list">Mailing Lists</a></li>
          <li id="nav_people"><a href="/people">People</a></li>
          <li id="nav_blog"><a href="https://blogs.apache.org/accumulo">Blog <i class="fa fa-external-link"></i></a></li>
          <li id="nav_projects"><a href="/projects">Community Projects</a></li>
          <li id="nav_thanks"><a href="/thanks">Thanks</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Governance</li>
          <li id="nav_bylaws"><a href="/bylaws">Bylaws</a></li>
          <li id="nav_consensusbuilding"><a href="/governance/consensusBuilding">Consensus Building</a></li>
          <li id="nav_lazyconsensus"><a href="/governance/lazyConsensus">Lazy Consensus</a></li>
          <li id="nav_govreleasing"><a href="/governance/releasing">Releasing</a></li>
          <li id="nav_voting"><a href="/governance/voting">Voting</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Development<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://issues.apache.org/jira/browse/ACCUMULO">Issue Tracker <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://github.com/apache/accumulo/pulls">Pull Requests <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://builds.apache.org/view/A/view/Accumulo">Jenkins Builds <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://travis-ci.org/apache/accumulo">TravisCI Builds <i class="fa fa-external-link"></i></a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Guides</li>
          <li id="nav_source"><a href="/source">Source &amp; Guide</a></li>
          <li id="nav_git"><a href="/git">Git Workflow</a></li>
          <li id="nav_versioning"><a href="/versioning">Versioning</a></li>
          <li id="nav_contrib"><a href="/contrib">Contrib Projects</a></li>
          <li id="nav_rb"><a href="/rb">Review Board</a></li>
          <li id="nav_releasing"><a href="/releasing">Making Releases</a></li>
          <li id="nav_verify_release"><a href="/verifying_releases">Verifying Releases</a></li>
        </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apache Software Foundation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://www.apache.org">Apache Homepage <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/licenses/LICENSE-2.0">License <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/security">Security <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/thanks">Thanks <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <i class="fa fa-external-link"></i></a></li>
        </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <h1 class="title">Filter Example</h1>
          
          <p>This is a simple filter example. It uses the AgeOffFilter that is provided as
part of the core package org.apache.accumulo.core.iterators.user. Filters are
iterators that select desired key/value pairs (or weed out undesired ones).
Filters extend the org.apache.accumulo.core.iterators.Filter class
and must implement a method accept(Key k, Value v). This method returns true
if the key/value pair are to be delivered and false if they are to be ignored.
Filter takes a “negate” parameter which defaults to false. If set to true, the
return value of the accept method is negated, so that key/value pairs accepted
by the method are omitted by the Filter.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance&gt; createtable filtertest
username@instance filtertest&gt; setiter -t filtertest -scan -p 10 -n myfilter -ageoff
AgeOffFilter removes entries with timestamps more than &lt;ttl&gt; milliseconds old
----------&gt; set AgeOffFilter parameter negate, default false keeps k/v that pass accept method, true rejects k/v that pass accept method:
----------&gt; set AgeOffFilter parameter ttl, time to live (milliseconds): 30000
----------&gt; set AgeOffFilter parameter currentTime, if set, use the given value as the absolute time in milliseconds as the current time of day:
username@instance filtertest&gt; scan
username@instance filtertest&gt; insert foo a b c
username@instance filtertest&gt; scan
foo a:b []    c
username@instance filtertest&gt;
</code></pre>
</div>

<p>… wait 30 seconds …</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance filtertest&gt; scan
username@instance filtertest&gt;
</code></pre>
</div>

<p>Note the absence of the entry inserted more than 30 seconds ago. Since the
scope was set to “scan”, this means the entry is still in Accumulo, but is
being filtered out at query time. To delete entries from Accumulo based on
the ages of their timestamps, AgeOffFilters should be set up for the “minc”
and “majc” scopes, as well.</p>

<p>To force an ageoff of the persisted data, after setting up the ageoff iterator
on the “minc” and “majc” scopes you can flush and compact your table. This will
happen automatically as a background operation on any table that is being
actively written to, but can also be requested in the shell.</p>

<p>The first setiter command used the special -ageoff flag to specify the
AgeOffFilter, but any Filter can be configured by using the -class flag. The
following commands show how to enable the AgeOffFilter for the minc and majc
scopes using the -class flag, then flush and compact the table.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance filtertest&gt; setiter -t filtertest -minc -majc -p 10 -n myfilter -class org.apache.accumulo.core.iterators.user.AgeOffFilter
AgeOffFilter removes entries with timestamps more than &lt;ttl&gt; milliseconds old
----------&gt; set AgeOffFilter parameter negate, default false keeps k/v that pass accept method, true rejects k/v that pass accept method:
----------&gt; set AgeOffFilter parameter ttl, time to live (milliseconds): 30000
----------&gt; set AgeOffFilter parameter currentTime, if set, use the given value as the absolute time in milliseconds as the current time of day:
username@instance filtertest&gt; flush
06 10:42:24,806 [shell.Shell] INFO : Flush of table filtertest initiated...
username@instance filtertest&gt; compact
06 10:42:36,781 [shell.Shell] INFO : Compaction of table filtertest started for given range
username@instance filtertest&gt; flush -t filtertest -w
06 10:42:52,881 [shell.Shell] INFO : Flush of table filtertest completed.
username@instance filtertest&gt; compact -t filtertest -w
06 10:43:00,632 [shell.Shell] INFO : Compacting table ...
06 10:43:01,307 [shell.Shell] INFO : Compaction of table filtertest completed for given range
username@instance filtertest&gt;
</code></pre>
</div>

<p>By default, flush and compact execute in the background, but with the -w flag
they will wait to return until the operation has completed. Both are
demonstrated above, though only one call to each would be necessary. A
specific table can be specified with -t.</p>

<p>After the compaction runs, the newly created files will not contain any data
that should have been aged off, and the Accumulo garbage collector will remove
the old files.</p>

<p>To see the iterator settings for a table, use config.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>username@instance filtertest&gt; config -t filtertest -f iterator
---------+---------------------------------------------+---------------------------------------------------------------------------
SCOPE    | NAME                                        | VALUE
---------+---------------------------------------------+---------------------------------------------------------------------------
table    | table.iterator.majc.myfilter .............. | 10,org.apache.accumulo.core.iterators.user.AgeOffFilter
table    | table.iterator.majc.myfilter.opt.ttl ...... | 30000
table    | table.iterator.majc.vers .................. | 20,org.apache.accumulo.core.iterators.user.VersioningIterator
table    | table.iterator.majc.vers.opt.maxVersions .. | 1
table    | table.iterator.minc.myfilter .............. | 10,org.apache.accumulo.core.iterators.user.AgeOffFilter
table    | table.iterator.minc.myfilter.opt.ttl ...... | 30000
table    | table.iterator.minc.vers .................. | 20,org.apache.accumulo.core.iterators.user.VersioningIterator
table    | table.iterator.minc.vers.opt.maxVersions .. | 1
table    | table.iterator.scan.myfilter .............. | 10,org.apache.accumulo.core.iterators.user.AgeOffFilter
table    | table.iterator.scan.myfilter.opt.ttl ...... | 30000
table    | table.iterator.scan.vers .................. | 20,org.apache.accumulo.core.iterators.user.VersioningIterator
table    | table.iterator.scan.vers.opt.maxVersions .. | 1
---------+---------------------------------------------+---------------------------------------------------------------------------
username@instance filtertest&gt;
</code></pre>
</div>

<p>When setting new iterators, make sure to order their priority numbers
(specified with -p) in the order you would like the iterators to be applied.
Also, each iterator must have a unique name and priority within each scope.</p>

        </div>

        
<footer>

  <p><a href="https://www.apache.org"><img src="/images/feather-small.gif" alt="Apache Software Foundation" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2016 The Apache Software Foundation. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>

  <p>Site created with <a href="https://getbootstrap.com">Bootstrap</a> including icons from
<a href="https://glyphicons.com">GLYPHICONS</a> and <a href="http://fontawesome.io">Font Awesome</a>.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
