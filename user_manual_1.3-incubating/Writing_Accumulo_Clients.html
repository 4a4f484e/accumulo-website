<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/bootstrap-theme.min.css" rel="stylesheet">
<link href="/css/dataTables.bootstrap.css" rel="stylesheet">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<title>User Manual: Writing Accumulo Clients</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.dataTables.min.js"></script>
<script src="/js/dataTables.bootstrap.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // configure Google Analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  if (ga.hasOwnProperty('loaded') && ga.loaded === true) {
    ga('create', 'UA-50934829-1', 'apache.org');
    ga('send', 'pageview');
  }
</script>
</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/"><img id="nav-logo" alt="Apache Accumulo" class="img-responsive" src="/images/accumulo-logo.png" width="200"/></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="nav navbar-nav">
        <li class="nav-link"><a href="/downloads">Download</a></li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">1.7.2 Release (Latest)</li>
          <li id="nav_rn_172"><a href="/release_notes/1.7.2">Release Notes</a></li>
          <li><a href="/1.7/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.7/apidocs">Javadoc</a></li>
          <li id="nav_examples_17"><a href="/1.7/examples">Examples</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">1.6.5 Release</li>
          <li id="nav_rn_165"><a href="/release_notes/1.6.5">Release Notes</a></li>
          <li><a href="/1.6/accumulo_user_manual">User Manual</a></li>
          <li><a href="/1.6/apidocs">Javadoc</a></li>
          <li id="nav_examples_16"><a href="/1.6/examples">Examples</a></li>
          <li class="divider"></li>
          <li id="nav_features"><a href="/notable_features">Features</a></li>
          <li id="nav_rn"><a href="/release_notes">Release Notes Archive</a></li>
          <li id="old_documentation"><a href="/old_documentation">Documentation Archive</a></li>
          <li id="nav_screenshots"><a href="/screenshots">Screenshots</a></li>
          <li id="nav_papers"><a href="/papers">Papers &amp; Presentations</a></li>
          <li id="nav_glossary"><a href="/glossary">Glossary</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li id="nav_getinvolved"><a href="/get_involved">Get Involved</a></li>
          <li id="nav_mailinglists"><a href="/mailing_list">Mailing Lists</a></li>
          <li id="nav_people"><a href="/people">People</a></li>
          <li id="nav_blog"><a href="https://blogs.apache.org/accumulo">Blog <i class="fa fa-external-link"></i></a></li>
          <li id="nav_projects"><a href="/projects">Community Projects</a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Governance</li>
          <li id="nav_bylaws"><a href="/bylaws">Bylaws</a></li>
          <li id="nav_consensusbuilding"><a href="/governance/consensusBuilding">Consensus Building</a></li>
          <li id="nav_lazyconsensus"><a href="/governance/lazyConsensus">Lazy Consensus</a></li>
          <li id="nav_govreleasing"><a href="/governance/releasing">Releasing</a></li>
          <li id="nav_voting"><a href="/governance/voting">Voting</a></li>
        </ul>
        </li>
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Development<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://issues.apache.org/jira/browse/ACCUMULO">Issue Tracker <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://github.com/apache/accumulo/pulls">Pull Requests <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://builds.apache.org/view/A/view/Accumulo">Jenkins Builds <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://travis-ci.org/apache/accumulo">TravisCI Builds <i class="fa fa-external-link"></i></a></li>
          <li class="divider"></li>
          <li class="dropdown-header">Guides</li>
          <li id="nav_source"><a href="/source">Source &amp; Guide</a></li>
          <li id="nav_git"><a href="/git">Git Workflow</a></li>
          <li id="nav_versioning"><a href="/versioning">Versioning</a></li>
          <li id="nav_contrib"><a href="/contrib">Contrib Projects</a></li>
          <li id="nav_rb"><a href="/rb">Review Board</a></li>
          <li id="nav_releasing"><a href="/releasing">Making Releases</a></li>
          <li id="nav_verify_release"><a href="/verifying_releases">Verifying Releases</a></li>
        </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apache Software Foundation<span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="https://www.apache.org">Apache Homepage <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/licenses/LICENSE-2.0">License <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/security">Security <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/thanks">Thanks <i class="fa fa-external-link"></i></a></li>
          <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <i class="fa fa-external-link"></i></a></li>
        </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <h1 class="title">User Manual: Writing Accumulo Clients</h1>
          
          <p>** Next:** <a href="Table_Configuration.html">Table Configuration</a> ** Up:** <a href="accumulo_user_manual.html">Apache Accumulo User Manual Version 1.3</a> ** Previous:** <a href="Accumulo_Shell.html">Accumulo Shell</a>   ** <a href="Contents.html">Contents</a>**</p>

<p><a id="CHILD_LINKS"></a><strong>Subsections</strong></p>

<ul>
  <li><a href="Writing_Accumulo_Clients.html#Writing_Data">Writing Data</a></li>
  <li><a href="Writing_Accumulo_Clients.html#Reading_Data">Reading Data</a></li>
</ul>

<hr />

<h2 id="a-idwritingaccumuloclientsa-writing-accumulo-clients"><a id="Writing_Accumulo_Clients"></a> Writing Accumulo Clients</h2>

<p>All clients must first identify the Accumulo instance to which they will be communicating. Code to do this is as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>String instanceName = "myinstance";
String zooServers = "zooserver-one,zooserver-two"
Instance inst = new ZooKeeperInstance(instanceName, zooServers);

Connector conn = new Connector(inst, "user","passwd".getBytes());
</code></pre>
</div>

<h2 id="a-idwritingdataa-writing-data"><a id="Writing_Data"></a> Writing Data</h2>

<p>Data are written to Accumulo by creating Mutation objects that represent all the changes to the columns of a single row. The changes are made atomically in the TabletServer. Clients then add Mutations to a BatchWriter which submits them to the appropriate TabletServers.</p>

<p>Mutations can be created thus:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Text rowID = new Text("row1");
Text colFam = new Text("myColFam");
Text colQual = new Text("myColQual");
ColumnVisibility colVis = new ColumnVisibility("public");
long timestamp = System.currentTimeMillis();

Value value = new Value("myValue".getBytes());

Mutation mutation = new Mutation(rowID);
mutation.put(colFam, colQual, colVis, timestamp, value);
</code></pre>
</div>

<h3 id="a-idbatchwritera-batchwriter"><a id="BatchWriter"></a> BatchWriter</h3>

<p>The BatchWriter is highly optimized to send Mutations to multiple TabletServers and automatically batches Mutations destined for the same TabletServer to amortize network overhead. Care must be taken to avoid changing the contents of any Object passed to the BatchWriter since it keeps objects in memory while batching.</p>

<p>Mutations are added to a BatchWriter thus:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>long memBuf = 1000000L; // bytes to store before sending a batch
long timeout = 1000L; // milliseconds to wait before sending
int numThreads = 10;

BatchWriter writer =
    conn.createBatchWriter("table", memBuf, timeout, numThreads)

writer.add(mutation);

writer.close();
</code></pre>
</div>

<p>An example of using the batch writer can be found at <br />
accumulo/docs/examples/README.batch</p>

<h2 id="a-idreadingdataa-reading-data"><a id="Reading_Data"></a> Reading Data</h2>

<p>Accumulo is optimized to quickly retrieve the value associated with a given key, and to efficiently return ranges of consecutive keys and their associated values.</p>

<h3 id="a-idscannera-scanner"><a id="Scanner"></a> Scanner</h3>

<p>To retrieve data, Clients use a Scanner, which provides acts like an Iterator over keys and values. Scanners can be configured to start and stop at particular keys, and to return a subset of the columns available.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// specify which visibilities we are allowed to see
Authorizations auths = new Authorizations("public");

Scanner scan =
    conn.createScanner("table", auths);

scan.setRange(new Range("harry","john"));
scan.fetchFamily("attributes");

for(Entry&lt;Key,Value&gt; entry : scan) {
    String row = e.getKey().getRow();
    Value value = e.getValue();
}
</code></pre>
</div>

<h3 id="a-idbatchscannera-batchscanner"><a id="BatchScanner"></a> BatchScanner</h3>

<p>For some types of access, it is more efficient to retrieve several ranges simultaneously. This arises when accessing a set of rows that are not consecutive whose IDs have been retrieved from a secondary index, for example.</p>

<p>The BatchScanner is configured similarly to the Scanner; it can be configured to retrieve a subset of the columns available, but rather than passing a single Range, BatchScanners accept a set of Ranges. It is important to note that the keys returned by a BatchScanner are not in sorted order since the keys streamed are from multiple TabletServers in parallel.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ArrayList&lt;Range&gt; ranges = new ArrayList&lt;Range&gt;();
// populate list of ranges ...

BatchScanner bscan =
    conn.createBatchScanner("table", auths, 10);

bscan.setRanges(ranges);
bscan.fetchFamily("attributes");

for(Entry&lt;Key,Value&gt; entry : scan)
    System.out.println(e.getValue());
</code></pre>
</div>

<p>An example of the BatchScanner can be found at <br />
accumulo/docs/examples/README.batch</p>

<hr />

<p>** Next:** <a href="Table_Configuration.html">Table Configuration</a> ** Up:** <a href="accumulo_user_manual.html">Apache Accumulo User Manual Version 1.3</a> ** Previous:** <a href="Accumulo_Shell.html">Accumulo Shell</a>   ** <a href="Contents.html">Contents</a>**</p>


        </div>

        
<footer>

  <p><a href="https://www.apache.org"><img src="/images/feather-small.gif" alt="Apache Software Foundation" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2016 The Apache Software Foundation. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>

  <p>Site created with <a href="https://getbootstrap.com">Bootstrap</a> including icons from
<a href="https://glyphicons.com">GLYPHICONS</a> and <a href="http://fontawesome.io">Font Awesome</a>.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
